# CLAUDE.md

This file provides guidance to Claude Code (claude.ai/code) when working with code in this repository.

Project summary
- VS Code extension that translates selected text and shows translation in a hover. Supports Google Translate (HTTP scrape) and OpenAI-based translation. Provides a command to paste the translation at the cursor and a debug output channel.

Quick commands
- Install deps: npm ci
- Build (compile TypeScript): npm run compile
- Watch (rebuild on change): npm run watch
- Run tests: npm test
- Run a single test file: (no direct script) Use the VS Code test launch in `vsc-extension-quickstart.md` or run mocha against `test/*.test.ts` after compiling (npm run compile). Example: npx mocha --extension ts-node/register "test/extension.test.ts"
- Lint: npm run lint
- Package VSIX: npm run package

High-level architecture
- Entry point: src/extension.ts (activate/deactivate, hover registration, command registration, debounce and caching)
- Providers: src/providers/google.ts (scrapes Google Translate public endpoint), src/providers/openai.ts (uses OpenAI SDK, includes system-role compatibility detection and LLM-based language detection)
- UI: src/ui/hover.ts (creates trusted Markdown hover with paste action)
- Utilities:
  - src/utils/languageDetector.ts (regex-based heuristic detector and resolveTargetLanguage helper)
  - src/utils/format.ts (small formatter for translation results)
  - src/utils/logger.ts (vscode OutputChannel wrapper with debug/info/error)
- Config/types/constants: src/config.ts, src/constants.ts, src/types.ts
- Tests: test/extension.test.ts (Mocha)

Notes & recommendations
- There is no top-level LICENSE file. Consider adding one to clarify reuse and distribution (Recommended: MIT or Apache-2.0 depending on preference).
- package.json scripts are minimal and rely on tsc + vscode-test. The test harness uses @vscode/test-electron. Running tests locally via mocha requires compiling first.
- The extension uses Google Translate by scraping translate.google.com and should be treated with caution for long-term reliabilityâ€”consider documenting this and/or adding a feature flag.
- OpenAI integration expects configuration keys in the VS Code settings (translateHover.openaiApiKey / openaiBaseUrl). Make sure these are documented in README or settings schema.

Important files
- package.json (manifest, scripts, publish metadata)
- src/extension.ts
- src/providers/google.ts
- src/providers/openai.ts
- src/ui/hover.ts
- src/utils/languageDetector.ts
- test/extension.test.ts

Common pitfalls for automation
- Tests rely on compiled output (out/) and TypeScript strict mode; always run `npm run compile` before `npm test`.
- There is no CI config in the repo; if adding CI, run lint/compile/test and consider checking for common mistakes (missing API key handling and network timeouts).

Contact / contributor notes
- The repository owner listed in package.json is `satokaz` (publisher). If you add CI or change publishing details, confirm with the owner.

Generated by Claude Code - keep this file concise and stable.
